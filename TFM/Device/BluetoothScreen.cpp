#include "BluetoothScreen.h"

#include "DeviceLogger.h"

BluetoothScreen::BluetoothScreen()
    : title_{"", 12, screen_.fontMax()},
      numberOfPinMessages_{3},
      pinMessages_{new Screen::Message[numberOfPinMessages_]}

{
    LOG_DEBUG("BluetoothScreen::BluetoothScreen()");
    
    // Fill pin's messages data
    const uint16_t titleYSize = title_.yPos * 2;
    pinMessages_[1].text = String("Button 1 -> Equal");
    pinMessages_[2].text = String("Button 2 -> No Equal");
    const uint16_t spaceForMessage{static_cast<uint16_t>((screen_.screenSizeY() - titleYSize) / numberOfPinMessages_)};

    for (size_t i = 0; i < numberOfPinMessages_; ++i)
    {
        pinMessages_[i].yPos = titleYSize + spaceForMessage * (i + 0.5);
        pinMessages_[i].fontSize = screen_.fontMax();
    }
}

BluetoothScreen::~BluetoothScreen()
{
    LOG_DEBUG("BluetoothScreen::~BluetoothScreen()");
    delete[] pinMessages_;
}

void BluetoothScreen::drawSearchingMessage()
{
    LOG_DEBUG("BluetoothScreen::drawSearchingMessage()");

    removeMessage(title_, blackColour);
    title_.text = "Waiting connection...";
    drawMessage(title_);
}

void BluetoothScreen::drawPinVerification(uint32_t pin)
{
    LOG_DEBUG(String("BluetoothScreen::BluetoothScreen() pin: ") + String(pin));

    pinMessages_[0].text = String("Check Pin: ") + String(pin);
    for (size_t i = 0; i < numberOfPinMessages_; ++i)
    {
        drawMessage(pinMessages_[i]);
    }
}

void BluetoothScreen::removePinVerification()
{
    LOG_DEBUG("BluetoothScreen::removePinVerification()");

    for (size_t i = 0; i < numberOfPinMessages_; ++i)
    {
        removeMessage(pinMessages_[i], blackColour);
    }
}

void BluetoothScreen::drawConnectionCorrect()
{
    LOG_DEBUG("BluetoothScreen::drawConnectionCorrect()");

    removeMessage(title_, blackColour);
    title_.text = "Connection correct";
    drawMessage(title_);

    uint16_t *connectionOkImage = new uint16_t[1024]{
        0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
        0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x10c2, 0x52a6, 0x7409, 0x950b, 0x9d6c, 0x9d6c, 0x8ceb, 0x73e9, 0x4266, 0x0881, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
        0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x3a24, 0x9529, 0xc6ec, 0xc6ec, 0xc70d, 0xcf0e, 0xcf0f, 0xcf0f, 0xcf0f, 0xc6ee, 0xbece, 0xbeae, 0x84aa, 0x29a4, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
        0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x1901, 0x9543, 0xbee7, 0xc6ea, 0xc70d, 0xcf0f, 0xd730, 0xd731, 0xd752, 0xd752, 0xd732, 0xd731, 0xcf10, 0xc6ee, 0xb6ac, 0xb6ab, 0x7c89, 0x10a1, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
        0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x4262, 0xb681, 0xb6c6, 0xbee9, 0xc70d, 0xcf0f, 0xd731, 0xd752, 0xdf53, 0xdf74, 0xdf74, 0xdf74, 0xdf53, 0xd752, 0xcf31, 0xc6ef, 0xb6ad, 0xae6a, 0xa60a, 0x31c3, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
        0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x52e1, 0xaea0, 0xb6a4, 0xbec8, 0xc6ec, 0xcf0e, 0xcf30, 0xd752, 0xdf53, 0xdf74, 0xdf75, 0xe775, 0xdf75, 0xdf75, 0xdf54, 0xd753, 0xcf11, 0xc6ef, 0xb6ac, 0xa669, 0xa628, 0x3a04, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
        0x0000, 0x0000, 0x0000, 0x0000, 0x4261, 0xae80, 0xae82, 0xb6a6, 0xbeca, 0xc6ed, 0xcf0f, 0xd731, 0xd753, 0xdf74, 0xdf75, 0xe796, 0xe796, 0xe796, 0xe776, 0xdf75, 0xdf54, 0xd732, 0xc710, 0xbecd, 0xae8b, 0x9e28, 0x9e08, 0x2982, 0x0000, 0x0000, 0x0000, 0x0000,
        0x0000, 0x0000, 0x0000, 0x1901, 0x9e20, 0xa660, 0xae84, 0xb6a8, 0xbecb, 0xc6ee, 0xcf10, 0xd732, 0xdf53, 0xdf75, 0xe796, 0xe796, 0xe797, 0xe797, 0xe796, 0xdf76, 0xdf75, 0xd753, 0xcf31, 0xc6ee, 0xb6ac, 0xa649, 0x9607, 0x8d87, 0x0860, 0x0000, 0x0000, 0x0000,
        0x0000, 0x0000, 0x0000, 0x7cc1, 0x9e20, 0xa641, 0xae85, 0xb6a9, 0xbecc, 0xc6ee, 0xcf10, 0xd732, 0xdf54, 0xdf75, 0xe796, 0xe797, 0xe797, 0xe797, 0xe797, 0xe776, 0xdf75, 0xd754, 0xa66c, 0xae6c, 0xb6ac, 0xa66a, 0x9627, 0x8de5, 0x63e5, 0x0000, 0x0000, 0x0000,
        0x0000, 0x0000, 0x29c1, 0x9600, 0x9600, 0x9e43, 0xae66, 0xb6a9, 0xbecc, 0xc6ee, 0xcf10, 0xd732, 0xd753, 0xdf75, 0xe796, 0xe797, 0xe797, 0xe797, 0xe797, 0xe796, 0xdf75, 0xb6ad, 0x7dc5, 0x6d44, 0x9e2a, 0xa66a, 0x9e27, 0x8de5, 0x8dc5, 0x1901, 0x0000, 0x0000,
        0x0000, 0x0000, 0x6c40, 0x85c0, 0x9600, 0x9e23, 0xa666, 0xae89, 0xbecb, 0xc6ee, 0xcf10, 0xcf31, 0xd753, 0xdf75, 0xdf76, 0xe796, 0xe797, 0xe797, 0xe797, 0xe796, 0xbeee, 0x9626, 0x85c5, 0x6544, 0x4ca3, 0x8de8, 0x9627, 0x8de5, 0x85a4, 0x5b84, 0x0000, 0x0000,
        0x0000, 0x0880, 0x8580, 0x85a0, 0x8de0, 0x9623, 0xa646, 0xae89, 0xb6ab, 0xbecd, 0xc70f, 0xcf31, 0xd753, 0xdf54, 0xdf75, 0xe776, 0xe796, 0xe796, 0xe796, 0xc70f, 0xa667, 0x9627, 0x85c5, 0x6544, 0x6525, 0x9e49, 0x9627, 0x8dc5, 0x7d84, 0x7d44, 0x0000, 0x0000,
        0x0000, 0x3200, 0x7540, 0x7d60, 0x85a0, 0x95e3, 0x9e26, 0xae68, 0xb6aa, 0xbecc, 0xc6ee, 0xcf10, 0xcf32, 0xd753, 0xdf74, 0xdf75, 0xdf75, 0xe796, 0xc70f, 0xae88, 0xa667, 0x9626, 0x7da5, 0x7586, 0xae8b, 0xa649, 0x9606, 0x85c5, 0x7d84, 0x7d63, 0x2161, 0x0000,
        0x0000, 0x4300, 0x6500, 0x6d40, 0x7d80, 0x85c2, 0x9605, 0xa647, 0xae89, 0xb6ab, 0xbeed, 0xc70f, 0xcf31, 0xd732, 0xd753, 0xdf74, 0xdf74, 0xc6ef, 0xae88, 0xa688, 0x9e47, 0x8de6, 0x85e7, 0xb6ad, 0xae8a, 0x9e48, 0x8e06, 0x85a4, 0x7563, 0x6d22, 0x3a82, 0x0000,
        0x0000, 0x4380, 0x5cc0, 0x6500, 0x6d40, 0x7d82, 0x8dc4, 0x9e26, 0xa648, 0x9608, 0xb6cc, 0xbeed, 0xc70f, 0xcf31, 0xd732, 0xd753, 0xb6cd, 0xa668, 0xa668, 0x9e47, 0x8e06, 0x8e07, 0xbecd, 0xaeab, 0xa669, 0x9627, 0x8de5, 0x7d84, 0x7543, 0x6d22, 0x4302, 0x0000,
        0x0000, 0x3b60, 0x5480, 0x5cc0, 0x64e0, 0x7541, 0x7d83, 0x8dc5, 0x6483, 0x4c21, 0x8da7, 0xb6cc, 0xbeee, 0xc70f, 0xcf10, 0xae8b, 0x8e07, 0x9627, 0x9626, 0x8e06, 0x8e07, 0xbecd, 0xb6ac, 0xa66a, 0x9e28, 0x8e06, 0x85a4, 0x7563, 0x6d23, 0x64e2, 0x3b21, 0x0000,
        0x0000, 0x3b60, 0x4440, 0x4c60, 0x54a0, 0x64e1, 0x6d22, 0x4bc1, 0x3b60, 0x43e1, 0x4c41, 0x85a7, 0xb6ab, 0xbecd, 0x9609, 0x7da5, 0x7dc5, 0x7dc5, 0x7da5, 0x85e7, 0xb6ac, 0xb6ab, 0xa66a, 0x9e48, 0x8e06, 0x85c4, 0x7d83, 0x7543, 0x6502, 0x5ca1, 0x3b01, 0x0000,
        0x0000, 0x3300, 0x4420, 0x4420, 0x4c60, 0x54a0, 0x5cc1, 0x3320, 0x3300, 0x3b60, 0x43e1, 0x4c21, 0x7d86, 0x7d86, 0x5ce3, 0x6523, 0x6d44, 0x6d44, 0x7d85, 0xae8b, 0xae8a, 0xa669, 0x9e27, 0x8e06, 0x85c5, 0x7da3, 0x7563, 0x6502, 0x5cc1, 0x5ca1, 0x3aa1, 0x0000,
        0x0000, 0x2a60, 0x4420, 0x4420, 0x4420, 0x4440, 0x5480, 0x5ca1, 0x3320, 0x2b00, 0x3360, 0x3ba0, 0x4401, 0x4c41, 0x5481, 0x54a2, 0x5ca2, 0x6d24, 0x9e49, 0x9e48, 0x9e28, 0x9607, 0x8de5, 0x85c4, 0x7da3, 0x7563, 0x6d22, 0x64e2, 0x5cc1, 0x54a1, 0x2a00, 0x0000,
        0x0000, 0x1980, 0x4420, 0x4420, 0x3c20, 0x4420, 0x4c40, 0x5480, 0x5c81, 0x3320, 0x2b00, 0x3340, 0x3b80, 0x3bc0, 0x4400, 0x4421, 0x5ca2, 0x8e06, 0x9606, 0x8e06, 0x8de5, 0x85c5, 0x7da4, 0x7d83, 0x7562, 0x6d22, 0x6502, 0x5cc1, 0x5ca1, 0x54a1, 0x10e0, 0x0000,
        0x0000, 0x0040, 0x4440, 0x4420, 0x4420, 0x3c20, 0x4420, 0x4c40, 0x5481, 0x5481, 0x2b20, 0x2300, 0x2b20, 0x3360, 0x3380, 0x4c21, 0x7da4, 0x85c4, 0x85c4, 0x85a4, 0x7da3, 0x7d83, 0x7563, 0x6d42, 0x6d22, 0x6502, 0x5ce1, 0x5cc1, 0x54a1, 0x5421, 0x0000, 0x0000,
        0x0000, 0x0000, 0x32e0, 0x4420, 0x4420, 0x3c20, 0x3c00, 0x4420, 0x4c40, 0x5481, 0x5481, 0x2b00, 0x22e0, 0x2b20, 0x3bc1, 0x7543, 0x7563, 0x7583, 0x7583, 0x7563, 0x7563, 0x7542, 0x6d42, 0x6d22, 0x64e2, 0x5ce1, 0x5cc1, 0x5ca1, 0x5481, 0x3280, 0x0000, 0x0000,
        0x0000, 0x0000, 0x10e0, 0x4440, 0x4440, 0x4420, 0x3c20, 0x3c20, 0x4420, 0x4c40, 0x4c60, 0x5461, 0x2b00, 0x3360, 0x64e2, 0x6502, 0x6d22, 0x6d22, 0x6d22, 0x6d22, 0x6d22, 0x6502, 0x6502, 0x64e1, 0x5cc1, 0x5cc1, 0x5ca1, 0x5481, 0x5460, 0x0880, 0x0000, 0x0000,
        0x0000, 0x0000, 0x0000, 0x32e0, 0x4440, 0x4440, 0x4440, 0x4420, 0x4420, 0x4420, 0x4c40, 0x4c60, 0x4c61, 0x5481, 0x5cc1, 0x5cc1, 0x5ce1, 0x64e2, 0x64e2, 0x64e2, 0x64e1, 0x5ce1, 0x5cc1, 0x5cc1, 0x5ca1, 0x5ca1, 0x54a1, 0x4c60, 0x2a60, 0x0000, 0x0000, 0x0000,
        0x0000, 0x0000, 0x0000, 0x0060, 0x43e0, 0x4440, 0x4440, 0x4440, 0x4420, 0x4420, 0x4420, 0x4440, 0x4c60, 0x4c60, 0x5481, 0x54a1, 0x54a1, 0x5ca1, 0x5ca1, 0x5ca1, 0x5ca1, 0x5ca1, 0x5ca1, 0x5ca1, 0x54a1, 0x5481, 0x4c80, 0x43a0, 0x0020, 0x0000, 0x0000, 0x0000,
        0x0000, 0x0000, 0x0000, 0x0000, 0x1100, 0x4420, 0x4440, 0x4c60, 0x4c40, 0x4440, 0x4440, 0x4440, 0x4440, 0x4c40, 0x4c60, 0x4c61, 0x5481, 0x5481, 0x5481, 0x5481, 0x5481, 0x54a1, 0x54a1, 0x54a1, 0x5480, 0x4c60, 0x4400, 0x08a0, 0x0000, 0x0000, 0x0000, 0x0000,
        0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x1140, 0x4420, 0x4c60, 0x4c60, 0x4c60, 0x4c60, 0x4c60, 0x4c40, 0x4c40, 0x4c60, 0x4c60, 0x4c60, 0x5481, 0x5481, 0x5481, 0x5481, 0x5481, 0x5480, 0x5480, 0x4c60, 0x4400, 0x10e0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
        0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x10e0, 0x3bc0, 0x4c60, 0x4c60, 0x4c80, 0x4c80, 0x4c80, 0x4c80, 0x4c80, 0x5480, 0x5480, 0x5480, 0x5480, 0x5480, 0x5480, 0x5480, 0x4c80, 0x4c60, 0x3ba0, 0x08a0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
        0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0040, 0x2aa0, 0x4440, 0x4c60, 0x4c60, 0x5480, 0x5480, 0x5480, 0x54a0, 0x54a0, 0x54a0, 0x5480, 0x5480, 0x4c80, 0x4c60, 0x4440, 0x2240, 0x0020, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
        0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x08a0, 0x2a80, 0x4400, 0x4c60, 0x4c60, 0x4c80, 0x5480, 0x5480, 0x4c80, 0x4c60, 0x4c60, 0x43e0, 0x2240, 0x0860, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
        0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x10e0, 0x19c0, 0x2260, 0x2aa0, 0x2aa0, 0x2260, 0x19a0, 0x08c0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
        0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000};

    const uint16_t titleYSize = title_.yPos * 2;
    Screen::Image image;
    image.xSize = 32;
    image.ySize = 32;
    image.xPos = static_cast<uint16_t>(screen_.screenSizeX() / 2 - image.xSize / 2);
    image.yPos = static_cast<uint16_t>(titleYSize + (screen_.screenSizeY() - titleYSize) / 2 - image.ySize / 2);
    image.picture = connectionOkImage;
    drawImage(image);
    delete connectionOkImage;
}
